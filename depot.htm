<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
     <meta charset="UTF-8">
<title></title>
    <style>
        table, td { border: 1px solid #999; border-collapse: collapse; padding:3px;}
        table.Benutzer td.col_BenutzerAbo td.col_Woche, .BenutzerBestellView .col_Benutzer_ID, .BenutzerBestellView .col_Depot_ID, .BenutzerBestellView .col_Produkt_ID, .DepotBestellView .col_Depot_ID, .DepotBestellView .col_Produkt_ID, .GesamtBestellView .col_Produkt_ID, .BenutzerView .col_Depot_ID, .BenutzerView .col_Role_ID { display:none; }


	
		div.fixedHeaderTable > table > tr:first-child > td {
			position: -webkit-sticky; /* for Safari */
  			position: sticky;
  			top: 0;
  			background:#EEE;
  			z-index: 222;
  			box-shadow: 0px 0px 0px 1px #999;
		}
		div.fixedHeaderTable > table > tr:nth-child(1n+2) > td:nth-child(2) {
			position: -webkit-sticky; /* for Safari */
  			position: sticky;
  			left: 0;
  			background:#EEE;
  			z-index: 111;
  			box-shadow: 0px 0px 0px 1px #999;
		}

        .col_ErstellZeitpunkt, .col_AenderZeitpunkt, .col_AenderBenutzer_ID { font-size: 75%; color:#999; }

        .weektable {
            font-size: 11.8px;
            text-align: center;
        }
        .weektable td {
            cursor:pointer;
        }
        .weektable td.inactive:hover, .weektable td span:hover, .weekWeek:hover, .weektable a:hover {
            background-color:orange;
        }
        .weektable td.active {
            background-color:yellow;
        }
        .weektable td.active:hover, .weekWeek:hover, .weektable a:hover {
            background-color:aqua;
        }

    </style>
    <script src="util.js"> </script>
    <script src="weekSelect.js"> </script>
    <script src="solawiBestellSystem.js"> </script>
    <script src="solawiTableValidator.js"> </script>
    <script src="solawiTableEditor.js"> </script>
    <script src="solawiTableVerwalter.js"> </script>
    <script src="solawiTable.js"> </script>

	<script src="https://cdn.jsdelivr.net/npm/exceljs@1.13.0/dist/exceljs.min.js"></script>
	<script type="text/javascript" src="FileSaver.min.js"></script>
    <!-- add the shim first
	<script type="text/javascript" src="shim.min.js"></script>-->
	<!-- after the shim is referenced, add the library
	<script type="text/javascript" src="xlsx.full.min14.js"></script>-->

</head>
<body>

<script>
var SBS = SolawiBestellSystem();
var SBTedit= SolawiTable(SBS, 'table', 'tablePath', true, false, true);
var SBTview = SolawiTable(SBS, 'tableEdit', 'tableEditPath', false, false);

//check login status
getAjax('Benutzer/OWN', function(userResponse){
    if (userResponse.length > 0 && userResponse[0]) {
        SBS.user = userResponse[0];
        document.getElementById('logoutbtn').innerText='Logout ' + SBS.user.Name;
        setContent('selectedWeek', SBS.selectedWeek);
        if (SBS.user.Role_ID != 3) {
            setContent('warning', 'Du bist als BENUTZER ANGEMELDET und siehst NUR DEINE BESTELLUNGEN / darfst nicht bearbeiten. Bitte abmelden (logout) und ALS ADMIN ANMELDEN.');
        }
    } else {
        show('loginform');
        hide('logoutbtn');
        hide('tableContainer');
    }
});

SBS.fillCache('Modul');
SBS.fillCache('Role');
SBS.fillCache('Depot');
SBS.fillCache('Produkt');
SBS.fillCache('Benutzer');

function changeWeek(count) {
    SBS.selectedWeek = addWeek(SBS.selectedWeek, count);
    setContent('selectedWeek', SBS.selectedWeek);
    if (SBTview.getTableName() && SBTview.getTablePath()) {
        if (SBTview.getTablePath().match(/.*Woche.*/)) {
            getAjax(SBTview.getTableName()+'/Woche/'+SBS.selectedWeek, SBTview.showTable);
        } else if (SBTview.getTablePath().match(/.*Pivot.*/)) {
            getAjax(SBTview.getTableName()+'/'+SBS.selectedWeek, SBTview.showTable);
        }
    }
    if (SBTedit.getTableName() && SBTedit.getTablePath()) {
        if (SBTedit.getTablePath().match(/.*Woche.*/)) {
            getAjax(SBTedit.getTableName()+'/Woche/'+SBS.selectedWeek, SBTedit.showTable);
        } else if (SBTedit.getTablePath().match(/.*\/Bis\/.*/)) {
                getAjax(SBTedit.getTableName()+'/Bis/'+SBS.selectedWeek, SBTedit.showTable);
        } else if (SBTedit.getTablePath().match(/.*Pivot.*/)) {
            getAjax(SBTedit.getTableName()+'/'+SBS.selectedWeek, SBTedit.showTable);
        } else if (SBTedit.getTablePath().match(/^Benutzer$/)) {
            getAjax(SBTedit.getTableName(), SBTedit.showTable);
        }
    }
}

</script>


<div id="blockui_post" style="position:fixed;top:0;left:0;bottom:100%;right:100%;width:100%;height:100%;text-align:center;padding-top:30%;z-index:250;background-color:rgba(0,0,0,0.3);display:none;">
    <span style="display:inline-block;padding:30px;background-color:#FFF;border:1px solid black;">SENDE DATEN...</span>
</div>
<div id="blockui_get" style="position:fixed;top:0;left:0;bottom:100%;right:100%;width:100%;height:100%;text-align:center;padding-top:30%;z-index:240;background-color:rgba(0,0,0,0.3);display:none;">
    <span style="display:inline-block;padding:30px;background-color:#FFF;border:1px solid black;">EMPFANGE DATEN - BITTE WARTEN....</span>
</div>
<div id="blockui_edit" style="position:fixed;top:0;left:0;bottom:100%;right:100%;width:100%;height:100%;text-align:center;z-index:230;background-color:rgba(0,0,0,0.3);display:none;">
        <div style="display:inline-block;padding: 5px; margin: 10px; border:1px solid black;background-color:#FFF;">
        <div id="editError" style="color:red;font-weight:bold;"></div>
        <div id="editor" style="padding: 5px;"></div>
    </div>
</div>


<div id="logoutform" style="position:fixed;right: 1px; top: 0; width: 15em; height: 10em; background: rgba(222,222,222,0.6); border: 1px dotted #999;text-align:center;">
    <button id="logoutbtn" onclick="document.cookie = 'sessionid=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';show('loginform'); hide('logoutbtn');hide('tableContainer');" >Logout</button>
    <div id="messages" style="height:8.3em; overflow:hidden;font-size=85%;box-shadow: inset 0px -9px 9px -9px black;position:absolute;bottom:0;width:15em;">
    </div>
</div>

<div id="loginform" style="display:none">
    LOGIN:
    <form method='post' action='/cgi-bin/query.pl/login'>
        Name: <input type='text' id='inpName' name='name' placeholder='name'/>
        Password: <input type='password' id='inpPass' name='password'/>
        <input type='submit' value='Login' onclick='event.preventDefault();postAjax("/cgi-bin/logon.pl", {name:document.getElementById("inpName").value, password:document.getElementById("inpPass").value}, function(result,path){if (!(!result || !result.user)){window.setTimeout(function(){document.location.reload();},333);} else {show("loginError")};});return false;'/>
        <div id="loginError" style="display:none;color:red;font-weight:bold;padding-top:20px;">
        	Falscher Benutzername oder Falsches Passwort! Bitte mit den Login-Daten des <a href="https://www.solawi-rhein-neckar.org/intern/login/?redirect_to=https%3A%2F%2Fwww.solawi-rhein-neckar.org%2Fintern%2F">Mitgliederbereichs</a> anmelden!
        </div>
    </form>
    <br/><br/><a style="padding-left: 20px;" href="index.htm">Zur√ºck zu Startseite</a><br/>
 </div>


<div id="warning" style="color:red"></div>

<div id="tableContainer">
    <div style="width: 90%">
        <span style="display:inline-block;width:45%;vertical-align: top;border-right:1px dotted black;">
            <div style="text-align: center;padding: 5px 0 10px 0;white-space:nowrap;overflow:hidden;">
            	Berichte  &#160;  &#160; &#160; <b>Woche: </b><button onclick="changeWeek(-1)">&lt;&lt;</button><span id="selectedWeek" style="font-weight:bold;">00</span>        <button onclick="changeWeek(+1)">&gt;&gt;</button>  &#160; &#160; &#160; Bearbeiten  &#160;  &#160;  &#160; &#160;  &#160; &#160;
            </div>
	        <span style="display:inline-block;width: 60%;vertical-align: top;border-right:1px dotted black;">
	            <button onclick="SBTedit.reset();getAjax('BenutzerBestellView/Woche/'+SBS.selectedWeek, SBTview.showTable);">Lieferung (Benutzer)</button>
	            <button onclick="SBTedit.reset();getAjax('PivotBestellungen/'+SBS.selectedWeek, SBTview.showTable);">Lieferung (Solawi)</button>
	            <button onclick="SBTedit.reset();getAjax('PivotDepot/'+SBS.selectedWeek, SBTview.showTable);">Lieferung (Depot)</button>
	            <button onclick="getAjax('PivotBestellung/'+SBS.selectedWeek, downloadDepotbestellungen);">DOWNLOAD Solawi</button>
	        </span>
	        <span style="display:inline-block;width: 38%;vertical-align: top;">

	            <button onclick="SBTview.reset();getAjax('BenutzerModulAbo/Bis/'+SBS.selectedWeek, SBTedit.showTable);">ModulAbo (Zukunft)</button>
            	<button onclick="SBTview.reset();getAjax('BenutzerZusatzBestellung/Woche/'+SBS.selectedWeek, SBTedit.showTable);">ZusatzBestellungen</button>
            </span>

        </span>
        <span style="display:inline-block;width: 45%;vertical-align: top;">
            <div style="text-align: center;padding: 5px 0 10px 0;white-space:nowrap;overflow:hidden;">
            	Bearbeiten  &#160;  &#160; &#160; <b>ohne Woche</b>  &#160; &#160; &#160; Berichte
            </div>
	        <span style="display:inline-block;width: 48%;vertical-align: top;border-right:1px dotted black;">
            <button onclick="SBTview.reset();SBTedit.setSortBy('Name');getAjax('Benutzer', SBTedit.showTable);">Benutzer</button>
            <button onclick="SBTview.reset();getAjax('BenutzerModulAbo', SBTedit.showTable);">ModulAbo (Alle)</button>
            <button onclick="SBTview.reset();getAjax('BenutzerZusatzBestellung', SBTedit.showTable);">ZusatzBestellungen</button>
            <button onclick="SBTview.reset();getAjax('BenutzerUrlaub', SBTedit.showTable);">Urlaube</button>
	        </span>
	        <span style="display:inline-block;width: 48%;vertical-align: top;">
            	<button onclick="SBTedit.reset();getAjax('BenutzerView', SBTview.showTable);">Benutzer-Abo (Aktuell)</button>
	            <a target="_blank" href="print.htm#PivotBestellungen">Solawi_Lieferung_Drucken</a>
	            <a target="_blank" href="print.htm#PivotDepot">Depot_Lieferung_Drucken</a>
            </span>
        </span>
    </div>

    <br/>

    <div id="tableEditPath"> </div>
   	<table id="tableEdit" cellspacing="0" > </table>

    <div id="tablePath"> </div>
    <div class="fixedHeaderTable">
       	<table id="table" cellspacing="0" > </table>
    </div>



    <br/>
    <br/>

</div>

</body>
</html>
