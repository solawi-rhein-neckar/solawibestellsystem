<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
     <meta charset="UTF-8">
<title></title>
    <style>
        table, td { border: 1px solid #999; border-collapse: collapse; padding:3px;}
        .col_ErstellZeitpunkt, .col_AenderZeitpunkt, .col_AenderBenutzer_ID, .inp_Woche, .inp_Benutzer_ID, .col_Benutzer_ID, .col_Depot_ID, #table .col_Produkt_ID {display: none;}
        #table .col_Anzahl, .col_Produkt { font-weight: bold; }
        .col_ID > div {display: none;}
        .inp_Woche, .inp_Benutzer_ID {color:#CCC; pointer-events:none; }
        #greeting {
font-size: 125%;
padding-top: 100px;
background: url(https://www.solawi-rhein-neckar.org/public/wp-content/uploads/2016/06/Solawi-Logo-e1475176176128-2.png);
   background-position: top center;
    background-repeat: repeat;
background-repeat: no-repeat;

        }
        #navi { position: absolute;}

        .weektable {
            font-size: 16px;
            text-align: center;
        }
        .weektable td {
            cursor:pointer;
        }
        .weektable td.inactive:hover, .weektable td span:hover, .weekWeek:hover, .weektable a:hover {
            background-color:orange;
        }
        .weektable td.active {
            background-color:yellow;
        }
        .weektable td.active:hover, .weekWeek:hover, .weektable a:hover {
            background-color:aqua;
        }

    </style>
    <script src="util.js"> </script>
    <script src="table.js"> </script>
     <script src="weekSelect.js"> </script>
</head>
<body>

<script>
var SBS = SolawiBestellSystem();
var SBTedit= SolawiTable(SBS, 'tableEdit', 'tableEditPath', true, true);
var SBTview = SolawiTable(SBS, 'table', 'tablePath', false, true);
var SBTmodule = SolawiTable(SBS, 'tableModule', 'tableModulePath', true, true);
var reloadEdit = SBTedit.reload;
SBTedit.reload = function() {SBTview.reload(); reloadEdit();}

//check login status
getAjax('BenutzerView/MY', function(userResponse){
    if (userResponse.length > 0) {
        SBS.user = userResponse[0];
        setContent('logoutbtn', 'Logout ' + SBS.user.Name);

        setHtmlContent('calendarWeek', SBS.week + '<span style="font-weight:normal"> (' +  weekToDate(SBS.week, 4).toLocaleDateString() + ( SBS.date.getDay() != SBS.day ? ', in </span>' + ((7 + SBS.day - SBS.date.getDay()) % 7) + '<span style="font-weight:normal"> Tagen)</span>' : ', </span>heute<span style="font-weight:normal">)</span>' ));

        setHtmlContent('selectedWeek', ' ' + SBS.selectedWeek + '<span style="font-weight:normal"> (' +  weekToDate(SBS.selectedWeek, 4).toLocaleDateString() + ')</span>');

        setContent('Modul', SBS.user.Modul);

        getAjax('BenutzerBestellView/Benutzer_ID/MY/Woche/'+SBS.selectedWeek, SBTview.showTable);

        getAjax('BenutzerZusatzBestellung/Benutzer_ID/MY/Woche/'+SBS.selectedWeek, SBTedit.showTable);
        
        getAjax('BenutzerModulAbo/Benutzer_ID/MY/Woche/'+SBS.selectedWeek, SBTmodule.showTable);

        //getAjax('BenutzerUrlaub', SBTurlaub.showTable);
         var weekSelect = Object.create(WeekSelect);
         weekSelect.year = Number(SBS.selectedWeek.match(/[0-9]+/)[0]);
         weekSelect.tableName = 'BenutzerUrlaub/Benutzer_ID/' + SBS.user.ID,
         weekSelect.postData = {Benutzer_ID: SBS.user.ID, Woche: SBS.selectedWeek},
         weekSelect.allowMulti = false;
         weekSelect.addTo(document.getElementById('tableUrlaub'));

    } else {
        show('loginform');
        hide('logoutbtn');
        hide('greeting');
    }
});

SBS.fillCache('Produkt');
SBS.fillCache('Modul');

function changeWeek(count) {
    SBS.selectedWeek = addWeek(SBS.selectedWeek, count);
    setHtmlContent('selectedWeek', ' ' + SBS.selectedWeek + '<span style="font-weight:normal"> (' +  weekToDate(SBS.selectedWeek, 4).toLocaleDateString() + ')</span>');
    getAjax('BenutzerBestellView/Benutzer_ID/MY/Woche/'+SBS.selectedWeek, SBTview.showTable);
    getAjax('BenutzerZusatzBestellung/Benutzer_ID/MY/Woche/'+SBS.selectedWeek, SBTedit.showTable);
    getAjax('BenutzerModulAbo/Benutzer_ID/MY/Woche/'+SBS.selectedWeek, SBTmodule.showTable);
}

</script>


<div id="blockui_post" style="position:fixed;top:0;left:0;bottom:100%;right:100%;width:100%;height:100%;text-align:center;padding-top:30%;z-index:250;background-color:rgba(0,0,0,0.3);display:none;">
    SAVING DATA...
</div>
<div id="blockui_get" style="position:fixed;top:0;left:0;bottom:100%;right:100%;width:100%;height:100%;text-align:center;padding-top:30%;z-index:240;background-color:rgba(0,0,0,0.3);display:none;">
    LOADING - PLEASE WAIT
</div>
<div id="blockui_edit" style="position:fixed;top:0;left:0;bottom:100%;right:100%;width:100%;height:100%;text-align:center;z-index:230;background-color:rgba(0,0,0,0.3);display:none;">
    <div style="position:absolute;left:0;right:0;top:30%;">
        <div style="display:inline-block;padding: 6px;border:1px solid black;background-color:#FFF;">
            <div style="font-weight:bold;padding-bottom:5px;">Zusatzbestellung hinzufügen:</div>
            <div id="editError" style="color:red;font-weight:bold;"></div>
            <div id="editor" style="padding: 5px;"></div>
        </div>
    </div>
</div>


<div id="logoutform" style="position:fixed;right: 1px; top: 0; width: 15em; height: 5em; background: #EEE; border: 1px dotted #999;text-align:center;">
    <button id="logoutbtn" onclick="document.cookie = 'sessionid=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';show('loginform'); hide('logoutbtn');" >Logout</button>
    <div id="messages" style="height:3.3em; overflow:hidden;font-size=85%;box-shadow: inset 0px -9px 9px -9px black;">
    </div>
</div>

<div id="loginform" style="display:none">
    LOGIN:
    <form method='post' action='/cgi-bin/query.pl/login'>
        Name: <input type='text' id='inpName' name='name' placeholder='name'/>
        Password: <input type='password' id='inpPass' name='password'/>
        <input type='submit' value='Login' onclick='event.preventDefault();postAjax("/cgi-bin/logon.pl", {name:document.getElementById("inpName").value, password:document.getElementById("inpPass").value}, function(){window.setTimeout(function(){document.location.reload();},333);});return false;'/>
    </form>
</div>


<div id="navi">
    <a href="admin.htm">zu den Berichten + Admin-Bereich</a>
</div>
<div id="greeting">

    Die nächste Lieferung/Abholung ist in Kalenderwoche
    <span id="calendarWeek" style="font-weight:bold;">00</span>
    <br/>
    <br/>
    Deine Module (nächste Lieferung): <span id="Modul" style="font-weight:bold;">Vegetarisch_mit_Milch</span>
    <br/>
    <br/>
    <br/>
    Deine Gesamt-Lieferung in Kalenderwoche <button onclick="changeWeek(-1)">&lt;&lt;</button><span id="selectedWeek" style="font-weight:bold;">00</span>        <button onclick="changeWeek(+1)">&gt;&gt;</button>:

</div>

<br/>

<div id="tableContainer">
<!--
    <button onclick="getAjax('Benutzer', showTable);">Benutzer</button>
    <button onclick="getAjax('BenutzerUrlaub', showTable);">BenutzerUrlaub</button>
    <button onclick="getAjax('Depot', showTable);">Depot</button>
    <button onclick="getAjax('Modul', showTable);">Modul</button>
    <button onclick="getAjax('ModulInhalt', showTable);">ModulInhalt</button>
    <button onclick="getAjax('ModulInhaltWoche', showTable);">ModulInhaltWoche</button>
    <button onclick="getAjax('Produkt', showTable);">Produkt</button>
    <button onclick="getAjax('ZusatzBestellung', showTable);">ZusatzBestellung</button>-->

    <table id="table" cellspacing="0" > </table>
    <br/>
    <br/>
    Deine <strong>Zusatzbestellungen</strong> (in Gesamt-Lieferung oben bereits enthalten) für die oben gewählte Kalenderwoche bearbeiten:
    <br/>
    <br/>
    <table id="tableEdit" cellspacing="0" > </table>
    <br/>
    Hinweis: <strong>negative Anzahl</strong> bestellen, um etwas <strong>abzubestellen</strong>. Die insgesamt bestellte Anzahl ist in der Liefer-Tabelle fett gedruckt.
    <br/>
    <br/>
    <br/>
    Hinweis: Bestellungen, Module und Urlaub können nur für die ZUKUNFT geändert werden.
    <br/>Änderungen für <strong>vergangene Kalenderwochen ignoriert</strong> das System (derzeit leider noch stillschweigend)!
    <br/>
    <br/>
    <br/>
    Deine <strong>Module</strong> für die oben gewählte Kalenderwoche bearbeiten:
    <table id="tableModule" cellspacing="0" > </table>
    <br/>
    <br/>
    <br/>
    Deine geplanten <strong>Urlaube</strong> (keine Lieferung!):
    <br/>
    <div id="tableUrlaub" > </div>
    <div style="font-size:85%;color:#666;">(Nach Urlaubs-Änderung für aktuell oben angezeigte Woche:<br/> -> Bitte die Seite manuell neu aufrufen, oder die Woche wechseln, um die Anzeige zu aktualisieren.)</div>
    <br/>
    <br/>
    <br/>
    
</div>

    <!--

FRAGEN and depotleiter:

- regelmäßige serienbestellungen üblich? Beispiele? Jede Woche / Jeden Monat?

- Abo-Typ-Wechsel möglich?


-->

</body>
</html>
