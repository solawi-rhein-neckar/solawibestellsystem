<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta charset="UTF-8">
	<title>Ansicht Depot</title>
	<link rel="stylesheet" type="text/css" href="css/depot.css">
	<style>

.col_Cookie,.col_Passwort,.col_ErstellZeitpunkt,.col_AenderZeitpunkt,.col_AenderBenutzer_ID,.col_wpaccount_status,
.col_wpfirst_name,.col_wplast_name,.col_wpsession_tokens,.col_wpuser_login,.col_wpuser_nicename,.col_wpuser_pass,
.col_wpuser_activation_key,.col_wpuser_registered,.col_wpuser_status,.col_wpuser_url,.col_wpwp_user_level { display: none;}

</style>
	<script src="js/util.js"></script>
	<script src="js/weekSelect.js"></script>
	<script src="js/solawiBestellSystem.js"></script>
	<script src="js/solawiValidator.js"></script>
	<script src="js/solawiEditor.js"></script>	Beruf
	<script src="js/solawiTableEditor.js"></script>
	<script src="js/solawiTableVerwalter.js"></script>
	<script src="js/solawiTable.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/exceljs@1.13.0/dist/exceljs.min.js"></script>
	<script type="text/javascript" src="lib/FileSaver.min.js"></script>
</head>
<body>

	<script src="js/ui.js"></script>

	<script>
        var SBTedit = SolawiTable(SBS, 'table', 'tablePath', true, false);


        SBTedit.setSortBy('Name');
        //SBTedit.columns = [ 'Name', 'MitName', 'PunkteStand', 'PunkteWoche', 'Anteile', 'Fleisch Anteile', 'AnteileStartWoche', 'PunkteStart', 'Depot_ID', 'Role_ID',
        //        'Cookie', 'Passwort', 'AltName', 'ErstellZeitpunkt', 'AenderZeitpunkt', 'AenderBenutzer_ID' ];

		//initUser(function(){getAjax('Benutzer/ACTIVE', SBTedit.showTable);});

		initUser(function(){getAjax('/cgi-bin/wp.pl/', function(response, path){
	        var byWpId = {};
	        for (var j = 0; j < response.length; j++) {
				byWpId[response[j].ID] = response[j];
	        }
		    getAjax('Benutzer/ACTIVE', function(response2, path2) {
		        for (var i = 0; i < response2.length; i++) {
		            var usr = response2[i];
		            usr.NOTES = '';
		            if (usr.wpID) {
		                var wpUsr = byWpId[usr.wpID];
		                if (wpUsr) {
 		            		Object.keys(wpUsr).forEach(function(key) {
 		            		   usr['wp'+key]=wpUsr[key];
 		            		});
 		            		if (wpUsr.wpSynced) {
 		            		   usr.NOTES += ' !DUP_SYNC! ';
 		            		}
 		            		wpUsr.wpSynced = 1;
		                }
		            }
		            if (usr.wpMitID) {
		                var wpMit = byWpId[usr.wpMitID]
		                if (wpMit) {
 		            		usr.wpMitName = wpMit.display_name;
 		            		if (usr.Depot_ID && wpMit.Depot) {
 			            		var depot = SBS.tableCache['Depot'][usr.Depot_ID];
 			            		if (depot && wpMit.Depot != depot.wpName && !(wpMit.Depot == 'Hofteam' && depot.wpName == 'Selbstabholer')) {
 									usr.NOTES += ' !MIT_DEPOT! ';
 			            		}
 		            		}
		                }
		            	if (!usr.wpMitName) {
							usr.NOTES += ' !MISS_WP_MIT! ';
		            	} else if ((!usr.MitName) || usr.wpMitName.toLowerCase() != usr.MitName.toLowerCase()) {
							usr.NOTES += ' !MIT_NAME! ';
		            	}
		            } else {
		                usr.wpMitName = '';
		                if (usr.MitName) {
							usr.NOTES += ' !NO_WP_MIT! ';
		                }
		            }
		            if (!usr.wpID) {
		                usr.NOTES += ' !NO_WP! ';
		            } else {
		                if (!usr.wpdisplay_name) {
							usr.NOTES += ' !MISS_WP! ';
		                } else if ((!usr.Name) || usr.wpdisplay_name.toLowerCase() != usr.Name.toLowerCase()) {
							usr.NOTES += ' !NAME! ';
	            		}
	            		if (usr.Depot_ID && usr.wpDepot) {
		            		var depot = SBS.tableCache['Depot'][usr.Depot_ID];
		            		if (depot && usr.wpDepot != depot.wpName && !(usr.wpDepot == 'Hofteam' && depot.wpName == 'Selbstabholer')) {
								usr.NOTES += ' !DEPOT! ';
		            		}
	            		}
		            }
		        }
		        for (var j = 0; j < response.length; j++) {
		            var wpUsr = response[j];
					if (!wpUsr.wpSynced) {
					    var usr = {ID: -1, Name:'onlyWP'};
	            		Object.keys(wpUsr).forEach(function(key) {
            		    		usr['wp'+key]=wpUsr[key];
 		            		});
	            		response2.push(usr);
					}
		        }
		        SBTedit.showTable(response2, path2);
		    });
		}) });

        function changeWeek(count) {
        }
    </script>

	<div id="tableContainer">

		<div style="text-align: center; padding: 5px 0 10px 0; white-space: nowrap; overflow: hidden; width: 80%;">
			MITGLIEDER-VERWALTUNG &#160; - &#160; <a href="index.htm">zur√ºck zur Startseite</a>
		</div>

		<div id="tablePath"></div>
		<div class="fixedHeaderTable">
			<table id="table" cellspacing="0">
			</table>
		</div>

		<br /> <br /> <br />

	</div>

</body>
</html>
